
# Классификация DDoS-атак на основе IoT-датасета

## Введение

**Задача:** Обучить модель машинного обучения для автоматического обнаружения DDoS-атак в сетевом трафике IoT-устройств на основе открытого датасета CICIoT2023 (IoT Intrusion Dataset). Необходимо не только построить высокоточный классификатор, но и объяснить его решения с помощью методов интерпретации (SHAP), а также проанализировать контрфактические примеры – случаи, когда малые целенаправленные изменения во входных данных позволяют обойти детекцию.

**Датасет:** Используется набор данных, содержащий \~1.2 млн сетевых сессий (flows) с метками различных сетевых атак и нормального трафика. В данных представлены несколько типов атак (DDoS, DoS, Spoofing, ботнет Mirai, Recon и др.). В нашем проекте мы концентрируемся на бинарной классификации: распознавание **DDoS-атак** (Distributed Denial of Service) против всего остального трафика. Датасет относительно несбалансирован: DDoS-сессии составляют 75% всех данных, поэтому при оценке качества уделяется внимание метрикам, устойчивым к несбалансированности (например, F1-score).

## Выбор модели и качество классификации

Мы выбрали ансамблевый алгоритм **Random Forest** для решения задачи классификации DDoS. Случайный лес состоит из множества решающих деревьев, каждое обучается на случайной подвыборке данных и признаков, а итоговое решение принимается голосованием. Такой подход обладает рядом преимуществ для данной задачи:

* **Устойчивость к переобучению:** Ансамбль деревьев сглаживает индивидуальные ошибки моделей и хорошо обобщает, что важно на разнородных данных сетевого трафика.
* **Эффективность на табличных данных:** Random Forest хорошо работает с большим числом признаков без необходимости тщательного подбора гиперпараметров.
* **Интерпретируемость:** Модель позволяет оценивать важность признаков (встроенная feature importance), что облегчает последующий SHAP-анализ.

Для базового решения использовался `RandomForestClassifier` из scikit-learn с параметрами по умолчанию. Несмотря на отсутствие тонкой настройки, модель достигла высоких результатов: **F1-мера на тестовой выборке \~0.9998**, что свидетельствует о почти безошибочной классификации DDoS в тестовых данных. Такой высокий результат частично объясняется характером датасета: вероятно, паттерны DDoS-атак существенно отличаются от обычного трафика, и модель легко их выучивает. Тем не менее, важно понять, *за счёт каких признаков* достигается такая точность – это мы исследуем с помощью SHAP.

## Интерпретация модели: SHAP-анализ

Чтобы объяснить, **почему** модель помечает трафик как DDoS или нормальный, применяем SHAP (SHapley Additive exPlanations). SHAP – метод интерпретации на основе концепции коалиционной теории игр (значений Шепли). Он распределяет *справедливый вклад* каждого признака в предсказание модели, сравнивая прогноз с базовым уровнем.

Основная идея SHAP: моделируем вклад признака как его маргинальное влияние на результат во всех возможных комбинациях признаков. Формально, для каждого признака вычисляется SHAP-значение – насколько изменится выход модели, если добавить этот признак, усреднённо по всем подмножествам других признаков. Сумма SHAP-значений всех признаков равна разнице между выходом модели для данного примера и базовым значением (средним прогнозом по датасету).

> **Проще говоря:** SHAP отвечает на вопрос: *«Насколько каждый признак увеличивает или уменьшает уверенность модели в том, что это DDoS (по сравнению со средним случаем)?»* Положительное SHAP-значение означает, что признак “толкает” модель к классу DDoS, отрицательное – к классу «не DDoS».

Для интерпретации нашей модели мы использовали `TreeExplainer` на обученном Random Forest и рассчитали SHAP-значения для выборки данных. Глобальная важность признаков оценивалась по среднему абсолютному SHAP-вкладу. Полученная **диаграмма важности признаков** (SHAP summary plot в режиме bar) показала, что модель основывает решения преимущественно на нескольких ключевых характеристиках сетевого трафика. Ниже приведены самые влиятельные признаки и их влияние на определение DDoS-атаки:

## Ключевые признаки DDoS-трафика (по результатам SHAP)

| **Признак**                                                                                     | **Типичное значение в норме**                                                                     | **Типичное значение при DDoS**                                                                                                                                                                                  | **Влияние на модель**                                                                                                                                                                                                                                                                        |
| ----------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Inter-Arrival Time (IAT)**<br>*межпакетный интервал*                                          | Сотни миллисекунд (например, 100–500 мс между пакетами). Пакеты приходят относительно равномерно. | Чрезвычайно мал (< 10 мс) – пакеты следуют почти одновременно большими bursts.                                                                                                                                  | **Низкий IAT резко повышает вероятность DDoS.** Частые пакеты без пауз свидетельствуют о массовой атаке: модель научилась распознавать, что если трафик поступает с минимальными интервалами, это характерно для DDoS.                                                                       |
| **Размер пакетов** (средний и суммарный размер, **Tot size**, **Avg**, а также разброс **Std**) | Крупнее и разнообразнее. Обычный трафик содержит пакеты разных размеров; отклонения умеренные.    | Как правило, очень маленькие пакеты (средний размер \~50–100 байт), часто с минимальным содержимым. Возможны аномальные всплески дисперсии, если атака чередует размеры, но в основном пакеты однородно мелкие. | **Малый размер пакетов указывает на DDoS.** Модель выявила, что атака DDoS генерирует множество крошечных пакетов, чтобы перегрузить сеть количеством, а не объемом данных. Это явное отличие от обычного трафика, поэтому признаки, связанные с размером пакетов, сильно влияют на решение. |
| **Длительность соединения** (**flow\_duration**)                                                | Дольше: многие легитимные сессии длятся секунды и больше (может быть несколько секунд, минут).    | Крайне короткая – часто менее 1 секунды. Ботнеты инициируют массу коротких сессий, вместо длительных подключений.                                                                                               | **Очень короткие потоки характерны для DDoS.** Наша модель учитывает, что если связь обрывается почти сразу (сотни миллисекунд), велика вероятность атаки. Множество параллельных краткоживущих потоков – сигнал DDoS-атак, и этот признак получил высокий вклад в решениях модели.          |

*Примечание:* Эти наблюдения соответствуют природе DDoS-атак. Цель атакующих – создать максимальную нагрузку многочисленными запросами, поэтому **частота пакетов высока, пакеты малы, соединения кратковременны**. Random Forest успешно уловил эти паттерны и опирается на них при классификации. Важно отметить, что встроенные оценки важности в Random Forest (например, Gini importance) дали сходный набор лидирующих признаков, что подтверждается SHAP-анализом.

## Контрфактический эксперимент (устойчивость модели)

После выявления ключевых признаков возникает вопрос: **насколько устойчива модель к намеренному изменению этих признаков?** В контексте кибербезопасности это означает проверку, может ли злоумышленник обойти нашу модель, если ему известны её «слабые места». Мы провели простой контрфактический эксперимент:

1. **Выделили DDoS-примеры** из тестовых данных, которые модель правильно классифицировала (лейбл 1).
2. **Модифицировали главный признак** – резко увеличили IAT в копиях этих DDoS-примеров. Идея: сделать межпакетные интервалы ненормально большими, имитируя поведение, *не* свойственное атаке (замаскировать атаку под более разреженный трафик).
3. **Добавили изменённые примеры** обратно к данным и снова пропустили весь набор через модель.

Результат: качество классификации **существенно ухудшилось**. F1-мера модели упала с \~0.99 до **0.85** на модифицированном наборе. Многие ранее правильно обнаруженные DDoS-сессии после увеличения IAT перестали распознаваться моделью как атака. Таким образом, мы подтвердили гипотезу: признак *IAT критически важен* для детекции, и **манипуляция им позволяет атаке ускользнуть от модели**.

Этот контрфактический пример демонстрирует уязвимость модели к целенаправленным воздействиям на входные данные. По сути, мы смоделировали упрощённую *атаку на модель машинного обучения*: зная, что Random Forest полагается на низкий IAT, атакующий может увеличить задержки между пакетами, чтобы трафик казался «более нормальным» и обойти систему обнаружения. Это подтверждает вывод из научной литературы, что использование объяснимости (например, значений SHAP) помогает находить наиболее эффективные способы обмана модели по сравнению с случайными изменениями данных.

## Выводы

В данном проекте реализован классификатор DDoS-атак на базе Random Forest, достигший почти идеальной точности на тестовых данных. Однако через интерпретацию модели мы выяснили, *почему* он так хорошо работает: в трафике DDoS есть ярко выраженные черты (чрезвычайно низкие IAT, мелкие пакеты, короткие потоки и т.д.), на которых модель сфокусировалась. SHAP-анализ предоставил ценную информацию о вкладе признаков и подтвердил соответствие этих признаков доменному знанию о природе DDoS.

Тем не менее, мы обнаружили и слабое место: модель уязвима к изменению самых значимых признаков. В реальной практике это означает, что злоумышленник, изменив характер своего трафика (например, увеличив промежутки между пакетами или пакетные размеры), может снизить эффективность детектирования. Данный эксперимент подчёркивает необходимость учитывания *адаптивности атак* при разработке систем киберзащиты. В будущих работах стоило бы исследовать методы, повышающие устойчивость модели к подобным атакующим воздействиям (например, обучение на данных с искусственно внесёнными вариациями признаков или использование более сложных моделей/энSEMBLE подходов для обнаружения аномалий в комбинации признаков).

В заключение, сочетание **точной модели** и **интерпретируемости** позволило не только решить задачу классификации, но и получить глубокое понимание того, *как* модель принимает решения и *где* она может быть обойдена. Такой подход повышает доверие к модели и предоставляет ориентиры для её дальнейшего улучшения в контексте кибербезопасности.